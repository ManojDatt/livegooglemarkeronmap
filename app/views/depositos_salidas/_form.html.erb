
<section class="content">
  <div class="box-body">


     




 <% if depositos_salida.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(depositos_salida.errors.count, "error") %> prohibited this depositos from being saved:</h2>

      <ul>
      <% depositos_salida.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

 <div class="row">
            <div class="col-md-12" style="text-align: right;">

                 <%= link_to 'Cancelar', new_depositos_salida_path, :class=>"btn btn-md btn-default cancelbtn" %>
            </div>

  </div>


        <div class="row">

      <%= form_tag '', :method => "get", html: {:class => 'form-horizontal' } do %>
        <div class="col-md-3">
          <div class="form-group">
             <label>NUM. INVENTARIO</label>

            <%= text_field '',  :PKINVENTARIO, :value => params[:PKINVENTARIO] ,:class=>"form-control", :maxlength=>10, onkeypress: "return isNumber(event)" %>


        </div>
        </div>

         <div class="col-md-3">
            <div class="form-group">
            <label>&nbsp;</label>
                <%= submit_tag "BUSCAR",  :class=>"btn btn-md btn-primary", :style=>"margin-top:25px" %>

            </div>
         </div>

         <% end %>
         </div>
 <%= nested_form_for(@depositos_inventario, :validate => true, html: {:class => 'form-horizontal', :multipart => true } ) do |f| %>
       <div class="row">
        <div class="col-lg-9">

        <span class="content-body-span">INFORMACION DEL VEHICULO</span>

      <a href="javascript:void(0);"  id="btn_Inventorysubmit_popup" class="btn btn-md btn-success pull-right" >REALIZAR PAGO</a>

 <a href="javascript:void(0);" id="btn_submit_popup"  style="display: none;"  id="btn_submit_popup" class="btn btn-md btn-success pull-right" >REALIZAR PAGO</a>

<!--
<button id="btn_submit_popup" type="button" class="btn btn-md btn-success pull-right" ></button>
 -->
<!--  -->

         </div>


       </div>




         <div class="row">
        <div class="col-md-2">
          <div class="form-group">
             <label>FECHA INTRADAS</label>


  <%= f.text_field :INV_FINGRESO, :class=>"form-control", :maxlength=>20, :readonly => "true"%>

          </div>
           </div>
         <div class="col-md-2">
           <div class="form-group">
             <label>NUM. DIAS</label>


           <%= text_field '', :S_NumDias, :value=> @depositos_salida.S_NumDias, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
        </div>
         <div class="col-md-2">
           <div class="form-group">
             <label>IMPORTE DIARIO</label>


           <%= text_field '', :S_ImporteDiario, :value=> "$"+ @depositos_salida.S_ImporteDiario.to_s, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
        </div>

        <div class="col-md-2">
           <div class="form-group">
             <label>SUB TOTAL</label>


           <%= text_field '', :S_SubTotal, :value=> "$"+ @depositos_salida.S_SubTotal.to_s, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
        </div>

        <div class="col-md-2">
           <div class="form-group">
             <label>IVA</label>


           <%= text_field '', :S_IVA, :value=> "$"+ @depositos_salida.S_IVA.to_s, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
        </div>

         <div class="col-md-2">
           <div class="form-group">
             <label>TOTAL A PAGAR</label>


           <%= text_field '', :S_Total, :value=> "$"+ @depositos_salida.S_Total.to_s, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
        </div>




        </div>

  <div class="row">
        <div class="col-md-3">
          <div class="form-group">
             <label>FECHA DETENCION</label>


  <%= f.text_field :INV_FDETENCION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>

          </div>
           </div>


         <div class="col-md-3">
          <div class="form-group">
             <label>LUGAR DETENCION</label>

            <%= f.text_field :INV_LUGARDETENCION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>FOLIO DETENCION</label>

            <%= f.text_field :INV_FOLIODETENCION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
             <label>NUM. ORDEN GRUA</label>

            <%= f.text_field :INV_NUMORDEN, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

        </div>


         <div class="row">
         <div class="col-md-3">
          <div class="form-group">
             <label>TIPO DE VEHICULO</label>
             <%= f.collection_select :PKTIPO_AUTO, TipoVehiculo.order(:TAUT_DESCRIPCION), :PKTIPO_AUTO, :TAUT_DESCRIPCION, include_blank: true %>
            </div>

          </div>
        <div class="col-md-3">
          <div class="form-group">
             <label>MOTIVO DE LA DETENCION</label>

            <%= f.text_field :INV_MOTIVODETENCION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

        <div class="col-md-3">
          <div class="form-group">
             <label>AUTORIDAD</label>

            <%= f.text_field :INV_AUTORIDAD, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>DEPOSITO VEHICULAR</label>

             <%= f.collection_select :PKDEPOSITO, Deposito.order(:DEP_NOMBRE), :PKDEPOSITO, :DEP_NOMBRE, include_blank: true %>
          </div>
        </div>

        </div>

     <div class="row">
        <div class="col-md-3">
          <div class="form-group">
             <label>MARCA</label>

             <%= f.collection_select :PKMARCA, Marca.order(:MAR_DESCRIPCION), :PKMARCA, :MAR_DESCRIPCION, include_blank: true %>
          </div>
        </div>

       <div class="col-md-3">
          <div class="form-group">
             <label>SUBMARCA</label>

             <%= f.collection_select :PKSUBMARCA, SubMarca.order(:SUB_DESCRIPCION), :PKSUBMARCA, :SUB_DESCRIPCION, include_blank: true %>
          </div>
        </div>
         <div class="col-md-3">
          <div class="form-group">
             <label>COLOR</label>

             <%= f.collection_select :PKCOLOR, Colore.order(:COL_DESCRIPCION), :PKCOLOR, :COL_DESCRIPCION, include_blank: true %>
          </div>
        </div>
         <div class="col-md-3">
          <div class="form-group">
             <label>MODELO</label>

            <%= f.text_field :INV_MODELO, :class=>"form-control", onkeypress: "return isNumber(event)", :maxlength=>4, :readonly => "true" %>
          </div>
        </div>
        </div>

         <div class="row">
         <div class="col-md-3">
          <div class="form-group">
             <label>NUM. SERIE</label>

            <%= f.text_field :INV_NOSERIE, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>

       <div class="col-md-3">
          <div class="form-group">
             <label>NUM. MOTOR</label>

             <%= f.text_field :INV_NOMOTOR, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>
         <div class="col-md-3">
          <div class="form-group">
             <label>CONDICION</label>

            <%= f.text_field :INV_CONDICION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
             <label>PLACAS</label>

            <%= f.text_field :INV_PLACAS, :class=>"form-control", :maxlength=>10, :readonly => "true" %>
          </div>
        </div>

        </div>


        <div class="row">
         <div class="col-md-3">
          <div class="form-group">
             <label>PERTENENCIAS</label>

            <div class="checkbox icheck depositcheck">
              <label>
                <%= check_box_tag :TIENE_LLAVES, :value=>"checked", :style=>"margin-left:0px" %>
                <label>TIENE LLAVES</label>

              </label>
            </div>
          </div>
        </div>



        </div>





 <div class="row">

 <div class="col-md-12 deposito-inventory">
    <table id="tbl_pertenencias" class="table table-bordered" width="100% ">
                <tr>
                  <th >CANTIDAD</th>
                  <th>DESCRIPCION</th>
                  <th >CONDICION</th>
                  <th>

                    <a style="background-color:transparent">+</a>
                  </th>
                </tr >
                <%= f.fields_for :depositos_pertenencias, :wrapper => false do |tf| -%>

                <tr class="tr_pertenencias">

                  <td>
                   <%= tf.hidden_field :PKPERTENENCIA%>
                  <%= tf.text_field :PER_CANTIDAD, :class=>"form-control", onkeypress: "return isNumber(event)", :maxlength=>10, :readonly => "true" %></td>
                  <td><%= tf.text_field :PER_DESCRIPCION, :class=>"form-control", :maxlength=>20, :readonly => "true" %></td>
                  <td>
                     <%= tf.text_field :PER_CONDICION, :class=>"form-control", :maxlength=>20, :readonly => "true" %>
                  </td>
                <td>



                </td>
                </tr>

                <% end -%>

       </table>
 </div>
 </div>


 <div class="row">

 <div class="col-md-12">
  <div class="col-md-3">
  REGISTRO DE IMAGENES
  </div>
  <div class="col-md-3">
 &nbsp;
   </div>
    <div class="col-md-6">
    </div>
     </div>
      </div>
  <!-- </div>
   <div class="col-md-6"> -->
    <div class="row content_imagenes">
     <div class="col-md-3" style="display:none">
     &nbsp;
     </div>

    <%= f.fields_for :depositos_imagenes, :wrapper => false do |ti| -%>

     <div class="col-md-3 div_imagenes">
                <%= ti.hidden_field :PKIMAGEN%>

                       <% if ti.object.new_record? %>
                <%= ti.file_field :IMG_IMAGEN, :onChange => "readURL(this, #{ti.index})" %>

           <img height="50px;width:50px" id="<%= ti.index %>" src="/assets/no-image.png">



              <%= ti.link_to_remove "<i class='fa fa-fw fa-remove'></i>".html_safe, class:'btn btn-danger btn-xs',:onclick=>"DeleteRow_imagenes(this);" %>
              <%  else %>



               <a target="_blank" href="<%= ti.object.IMG_IMAGEN.url%>" > <img height="50px;" width="100px" src="<%= ti.object.IMG_IMAGEN.url%>"> </a>



              <% end %>
      </div>





   <% end -%>
   </div>


 </div>
 </div>







      <% end %>

  </div>



<!-- Modal PopUP -->


<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog" style="width:63% ">
  <%= form_for(depositos_salida, :validate => true, html: {class: 'form-horizontal'}) do |f| %>

    <!-- Modal content-->
    <div class="modal-content">

      <div class="modal-body">


          <% if depositos_salida.errors.any? %>
              <div id="error_explanation">
                <h2><%= pluralize(depositos_salida.errors.count, "error") %> prohibited this salidas from being saved:</h2>

                <ul>
                  <% depositos_salida.errors.full_messages.each do |message| %>
                      <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
          <% end %>

        <div class="row">
          <div class="col-md-3">
            <div class="form-group">
            <label>NUM.INVENTARIO</label>
              <%= f.text_field :PKINVENTARIO ,:class=>"form-control", :readonly => "true" %>
            </div>
          </div>
           <div class="col-md-1">
              &nbsp;

          </div>
            <div class="col-md-3">
              <div class="form-group">
               <label>RFC</label>
                <%= f.text_field :S_RFC ,:class=>"form-control" %>
              </div>

          </div>

        </div>

        <div class="row">
          <div class="col-md-7">
            <div class="form-group">
              <label>CLIENTE</label>
              <%= f.collection_select :S_CLIENTE, Cliente.order(:NOMBRE), :NOMBRE, :NOMBRE, include_blank: true %>
            </div>
          </div>
             <div class="col-md-5">
            <div class="form-group">
             <label style="width:100%">FECHA DE EXPEDICION</label>
             <%= f.date_select :S_FECHAPAGO, :class=>"form-control" %>
            </div>
          </div>
        </div>

      <div class="row">
        <div class="col-md-3">
          <div class="form-group">
             <label>METODO DE PAGO</label>
              <%= f.select :S_METODOPAGO, options_for_select( [['Efectivo','01'],['Cheque','02'],['Transferencia','03'],['Tarjetas de crédito','04'],['Monederos electrónicos','05'],['Dinero electrónico','06'],['Tarjetas digitales','07'],['Vales de despensa','08'],['Bienes','09'],['Servicio','10'],['Por cuenta de Tercero','11'],['Dación de pago','12'],['Pago por subrogación','13'],['Pago por consignación','14'],['Condonación','15'],['Cancelación','16'],['Compensación','17'],['NA','98'],['Otros','99']], @depositos_salida.S_METODOPAGO) %>
          </div>
        </div>
       <div class="col-md-3">
          <div class="form-group">
             <label>FORMA DE PAGO</label>
              <%= f.select :S_FORMA_DE_PAGO, options_for_select( [['Pago en una sola exhibición','Pago en una sola exhibición'],['Pago en parcialidades','Pago en parcialidades']], @depositos_salida.S_FORMA_DE_PAGO) %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>NUMERO DE CUENTA</label>
               <%= f.text_field :S_NUMCTA, :class=>"form-control", :maxlength => "4" %>
          </div>
        </div>
        </div>

        <div class="row" style="border-bottom: solid black 1px;margin-bottom: 5px;">
        <div class="col-lg-9">

        <span class="content-body-span">DIRECCION DEL CLIENTE</span>

         </div>


       </div>


       <div class="row">
           <div class="col-md-3">
          <div class="form-group">
             <label>DOMICILIO</label>
              <%= f.text_field :S_DOMICILIO, :class=>"form-control" %>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
             <label>NUM. EXTERIOR</label>
              <%= f.text_field :S_NoExterior, :class=>"form-control" %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>NUM. INTERIOR</label>
              <%= f.text_field :S_NoInterior, :class=>"form-control" %>
          </div>
        </div>
         <div class="col-md-3">
          <div class="form-group">
             <label>COLONIA</label>
              <%= f.text_field :S_Colonia, :class=>"form-control" %>
          </div>
        </div>
        </div>

         <div class="row">
           <div class="col-md-3">
          <div class="form-group">
             <label>REFERENCIA</label>
          <%= f.text_field :S_REFERENCIA, :class=>"form-control" %>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
             <label>LOCALIDAD</label>
              <%= f.text_field :S_Localidad, :class=>"form-control" %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>MUNICIPIO</label>
              <%= f.text_field :S_Municipio, :class=>"form-control" %>
          </div>
        </div>

        </div>

         <div class="row">
           <div class="col-md-3">
          <div class="form-group">
             <label>ESTADO</label>
              <%= f.text_field :S_Estado, :class=>"form-control" %>
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
             <label>PAIS</label>
              <%= f.text_field :S_Pais, :class=>"form-control" %>
          </div>
        </div>

         <div class="col-md-3">
          <div class="form-group">
             <label>CODIGO POSTAL</label>
              <%= f.text_field :S_CodigoPostal, :class=>"form-control", :maxlength=>"5" %>
          </div>
        </div>

        </div>

         <div class="row">

         <div class="col-md-2">
           <div class="form-group">
             <label>NUM. DIAS</label>


           <%= f.text_field :S_NumDias, :class=>"form-control", :maxlength=>20, :readonly => "true", :min => "1" %>

          </div>
        </div>
         <div class="col-md-3 ">
           <div class="form-group">
             <label>IMPORTE DIARIO</label>


           <%= f.text_field :S_ImporteDiario, :class=>"form-control", :maxlength=>20, :readonly => "true", :min => "1" %>

          </div>
        </div>

        <div class="col-md-2">
           <div class="form-group">
             <label>SUB TOTAL</label>


           <%= f.text_field :S_SubTotal, :class=>"form-control", :maxlength=>20, :readonly => "true", :min => "1" %>

          </div>
        </div>

        <div class="col-md-2">
           <div class="form-group">
             <label>IVA</label>


           <%= f.text_field :S_IVA, :class=>"form-control", :maxlength=>20, :readonly => "true", :min => "1" %>

          </div>
        </div>

         <div class="col-md-2">
           <div class="form-group">
             <label>TOTAL A PAGAR</label>


           <%= f.text_field :S_Total, :class=>"form-control", :maxlength=>20, :readonly => "true", :min => "1" %>

          </div>
        </div>




        </div>



      </div>
      <div class="modal-footer">
       <div class="col-md-6 ">
         <%= f.submit :class=>"btn btn-md btn-success pull-right", :value=>"REALIZAR COBRO" %>
        </div>

       <div class="col-md-6">
            <%= link_to 'Cancelar', new_depositos_salida_path, :class=>"btn btn-md btn-default cancelbtn pull-right" %>
             </div>
      </div>
    </div>
 <% end %>
  </div>
</div>
</section>

<script type="text/javascript">
  $(document).ready(function () {
  $("#asignacione_PKGRUA").addClass("form-control");
 $("#asignacione_PKOPERADOR").addClass("form-control");
 $("#depositos_inventario_PKTIPO_AUTO").addClass("form-control");
 $("#depositos_inventario_PKMARCA").addClass("form-control");
 $("#depositos_inventario_PKSUBMARCA").addClass("form-control");
$("#depositos_inventario_PKCOLOR").addClass("form-control");
$("#depositos_inventario_PKCOLOR").addClass("form-control");
$("#depositos_inventario_PKDEPOSITO").addClass("form-control");

$("#depositos_salida_S_CLIENTE").addClass("form-control");

$("#depositos_salida_S_METODOPAGO").addClass("form-control");
$("#depositos_salida_S_FORMA_DE_PAGO").addClass("form-control");



  $("#asignacione_PKGRUA").prop('disabled',true);
 $("#asignacione_PKOPERADOR").prop('disabled',true);
 $("#depositos_inventario_PKTIPO_AUTO").prop('disabled',true);
 $("#depositos_inventario_PKMARCA").prop('disabled',true);
 $("#depositos_inventario_PKSUBMARCA").prop('disabled',true);
$("#depositos_inventario_PKCOLOR").prop('disabled',true);
$("#depositos_inventario_PKCOLOR").prop('disabled',true);
$("#depositos_inventario_PKDEPOSITO").prop('disabled',true);


  $("#ShowINV_FDETENCION").datepicker({
      altField: '#depositos_inventario_INV_FDETENCION',
        minDate: 0,
        dateFormat: "dd/mm/yy"

    });



  window.NestedFormEvents.prototype.insertFields = function(content, assoc, link) {
   // console.log();
if ($(link).data("association")=='depositos_imagenes') {

 //$(.content div:last-child)
  var $tr = $('.content_imagenes div:last');//$("-child");


   $(content).insertAfter($tr);



}
else{
 var $tr =  $('#tbl_pertenencias tr:last');

   $(content).insertAfter($tr);

}


$('[name^="depositos_inventario[depositos_pertenencias_attributes]"]').each(function () {

    $(this).rules("add", {
        required: true//,
       // checkValue: true
    });
});

return;

}

  });

function DeleteRow_pertenencias(obj)
{

      var closestTr=$(obj).closest('.tr_pertenencias');
       $(closestTr).hide();
}

function DeleteRow_imagenes(obj)
{

    $(obj).closest('.div_imagenes').hide();

}

function readURL(input,div_id) {
  div_id = "#" + div_id;
  if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function (e) {

        $(div_id).attr('src', e.target.result);
    }
    reader.readAsDataURL(input.files[0]);
  }
}


  $(document).ready(function () {


$("#btn_Inventorysubmit_popup").click(function(e){



      obj=$("[id^=edit_depositos_inventario]");
          if (obj==null || obj.length<=0 || obj ==undefined)
          {


 obj=$("[id^=new_depositos_inventario]");
                  var isValid= obj.valid();

                  if (isValid==true) {

                  $("#btn_submit_popup").click();

                  }
        }
          else
          {


      obj=$("[id^=edit_depositos_inventario]");

                var isValid= obj.valid();

              if (isValid==true) {

              $("#btn_submit_popup").click();


              }

       }


} );


    $("#btn_submit_popup").click(function(){

        $("#myModal").modal({

            backdrop: 'static',

            keyboard: false

        });

    });

} );


</script>
